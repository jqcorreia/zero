import "std/c"

external "raylib" {
    fn InitWindow(width: i32, height: i32, title: str)
    fn BeginDrawing()
    fn EndDrawing()
    fn ClearBackground(color: Color)
    fn DrawRectangle(x: i32, y: i32, w: i32, h: i32, color: Color)
    fn GetKeyPressed() -> i32
    fn IsKeyPressed(key: i32) -> bool
    fn TakeScreenshot(filename: str)
    fn DrawText(text: str, posX: i32, posY: i32, fontSize: i32, color: Color)    
}

struct Color {
    r: u8
    g: u8
    b: u8
    a: u8
}

fn main() {
    W : i32 = 800
    H : i32 = 600

    background_color := Color{ r = 128, g = 128, b = 128, a = 255 }
    text_color := Color { r = 0, g = 128, b = 0, a = 255 }

    BLUE := Color{ r = 0, g = 121, b = 241, a = 255 }

    dir := 1

    x: i32 = 0
    col: i32 = 0
    speed: i32 = 10

    // Test struct field access (read)
    field := text_color.a
    printf("Text color alpha: %d\n", field)

    InitWindow(W, H, "Hello Raylib")
    for {
        keypressed := GetKeyPressed()

        if keypressed != 0 {
            printf("Key pressed: %d\n", keypressed)
        }
        if IsKeyPressed(256) { // escape key
            break
        }
        if keypressed == 80 { // escape key
           TakeScreenshot("screenshot.png")
        }
        if IsKeyPressed(263) { 
            x = x - speed
            col = col - 10
        }
        if IsKeyPressed(262) { 
            x = x + speed
            col = col + 10
        }

        // Test struct field access (write)
        background_color.r = col

        BeginDrawing()
        ClearBackground(background_color)
        DrawText("Press P for screenshot", 10, 10, 24, text_color)
        DrawText("Press Left/Right to move box", 10, 30, 24, text_color)
        DrawRectangle(x, H / 2 - 25, 50, 50, BLUE)
        EndDrawing()
    }
}

